<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
<head>
<!-- Put your custom HTML head tags here and select this file in the HTML output configuration. -->
<!-- Note: The content of this file has to be XML (XHTML). -->
<meta http-equiv="X-UA-Compatible" content="IE=8" />
<meta http-equiv="expires" content="43200" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<meta name="generator" content="Docmenta 1.9.0"/>
<title>4.6.1. AutoFormat Transformations</title>
<link rel="shortcut icon" href="favicon.ico" type="image/x-icon"/>
<link rel="home" href="index.html" title="Docmenta Tutorial and Reference"/>
<link rel="up" href="autoformat_plugins.html" title="4.6. AutoFormat plug-ins"/>
<link rel="prev" href="autoformat_plugins.html" title="4.6. AutoFormat plug-ins"/>
<link rel="prev" href="pt04ch06s02.html" title="4.6.2. AutoFormat Example"/>
<link rel="stylesheet" type="text/css" href="styles.css"/>
<link rel="stylesheet" type="text/css" href="common/jquery/theme-redmond/jquery-ui-1.8.2.custom.css"/>
<link rel="stylesheet" type="text/css" href="common/jquery/treeview/jquery.treeview.css"/>
<link rel="stylesheet" type="text/css" href="common/css/positioning.css"/>
<script type="text/javascript">
  var treeCookieId = "treeview-1494620492902";
  var language = "en";
  var w = new Object();
  txt_filesfound = "Results";
  txt_enter_at_least_1_char = "You must enter at least one character.";
  txt_browser_not_supported = "Your browser is not supported. Use of Mozilla Firefox is recommended.";
  txt_please_wait = "Please wait. Search in progress...";
  txt_results_for = "Results for: ";
</script>
<script type="text/javascript" src="common/jquery/jquery-1.4.2.min.js"></script>
<script type="text/javascript" src="common/jquery/jquery-ui-1.8.2.custom.min.js"></script>
<script type="text/javascript" src="common/jquery/jquery.cookie.js"></script>
<script type="text/javascript" src="common/jquery/treeview/jquery.treeview.min.js"></script>
<script type="text/javascript" src="search/htmlFileList.js"></script>
<script type="text/javascript" src="search/htmlFileInfoList.js"></script>
<script type="text/javascript" src="search/nwSearchFnt.js"></script>
<script type="text/javascript" src="search/stemmers/en_stemmer.js"></script>
<script type="text/javascript" src="search/index-1.js"></script>
<script type="text/javascript" src="search/index-2.js"></script>
<script type="text/javascript" src="search/index-3.js"></script>
<script type="text/javascript" src="custom.js"></script>
<script type="text/javascript" src="common/main.js"></script>
</head>
<body>
<div id="header"><img id="webhelplogo1" align="left" src='common/images/logo1.png' alt="Logo"/><img id="webhelplogo2" align="right" src='common/images/logo2.png' alt="Logo"/><div class="webhelptitle"><div class="webhelptitle1">Chapter 4.6. AutoFormat plug-ins</div><div class="webhelptitle2">4.6.1. AutoFormat Transformations</div></div><div id="navheader" align="right"><table><tr><td><img src="common/images/highlight-blue.gif" alt="H" onclick="toggleHighlight()" id="showHideHighlight" title="Toggle search result highlighting" /></td><td><a id="navhead-prev" accesskey="p" href="autoformat_plugins.html"><span class="navlink-text">Prev</span></a><span class="navhead-separator">&nbsp;|&nbsp;</span><a id="navhead-up" accesskey="u" href="autoformat_plugins.html"><span class="navlink-text">Up</span></a><span class="navhead-separator">&nbsp;|&nbsp;</span><a id="navhead-next" accesskey="n" href="pt04ch06s02.html"><span class="navlink-text">Next</span></a></td></tr></table></div></div>
<div id="leftnavigation"><div id="tabs"><ul id="tocsearchnavigation" style="display:none"><li id="tocnavigationtab"><a href="#treeDiv"><em>Contents</em></a></li><li id="searchnavigationtab"><a href="#searchDiv"><em>Search</em></a></li></ul><div id="treeDiv"><img src="common/images/loading.gif" alt="loading table of contents..." id="tocLoading" style="display:block;"/><div id="ulTreeDiv" style="display:none;"><div id="treenavigationtitle" style="display:none;">Contents</div><ul id="tree" class="filetree"><li><span class="file"><a href="pt04ch01.html">Introduction</a></span></li><li><span class="file"><a href="create_plugin_package.html">Creating a plug-in package</a></span></li><li><span class="file"><a href="plugin_api.html">Plug-in API</a></span><ul><li><span class="file"><a href="plugin_lifecycle_methods.html">Lifecycle methods</a></span></li><li><span class="file"><a href="plugin_add_menu.html">Adding menu items</a></span></li><li><span class="file"><a href="plugin_add_dialog.html">Adding a dialog</a></span><ul><li><span class="file"><a href="plugin_plain_js_dialogs.html">Plain JavaScript Dialogs</a></span></li><li><span class="file"><a href="plugin_zk_dialogs.html">ZK Dialogs</a></span></li></ul></li><li><span class="file"><a href="plugin_add_tab.html">Adding a tab</a></span></li><li><span class="file"><a href="plugin_jsp_integration.html">JSP integration</a></span></li><li><span class="file"><a href="pt04ch03s06.html">Accessing content</a></span></li></ul></li><li><span class="file"><a href="content_handler_plugins.html">Editor and viewer plug-ins</a></span><ul><li><span class="file"><a href="pt04ch04s01.html">Content Handlers</a></span></li><li><span class="file"><a href="plug_viewer.html">Viewer Plug-ins</a></span><ul><li><span class="file"><a href="pt04ch04s02s01.html">initialize</a></span></li><li><span class="file"><a href="pt04ch04s02s02.html">getApplicationId</a></span></li><li><span class="file"><a href="pt04ch04s02s03.html">getApplicationName</a></span></li><li><span class="file"><a href="pt04ch04s02s04.html">getSupportedViewExtensions</a></span></li><li><span class="file"><a href="pt04ch04s02s05.html">getSupportedEditExtensions</a></span></li><li><span class="file"><a href="pt04ch04s02s06.html">getPreviewURL</a></span></li><li><span class="file"><a href="pt04ch04s02s07.html">openViewer</a></span></li><li><span class="file"><a href="pt04ch04s02s08.html">openEditor</a></span></li><li><span class="file"><a href="pt04ch04s02s09.html">setCharEntities</a></span></li><li><span class="file"><a href="plug_view_handler_complete.html">The complete viewer class</a></span></li><li><span class="file"><a href="pt04ch04s02s11.html">The view.jsp page</a></span></li><li><span class="file"><a href="plug_viewer_package.html">Creating the viewer plug-in</a></span></li><li><span class="file"><a href="plug_viewer_install.html">Installing the viewer plug-in</a></span></li></ul></li><li><span class="file"><a href="pt04ch04s03.html">Editor Plug-ins</a></span><ul><li><span class="file"><a href="pt04ch04s03s01.html">getSupportedEditExtensions</a></span></li><li><span class="file"><a href="pt04ch04s03s02.html">openEditor</a></span></li><li><span class="file"><a href="plug_edit_handler_complete.html">The complete editor class</a></span></li><li><span class="file"><a href="pt04ch04s03s04.html">The edit.jsp page</a></span></li><li><span class="file"><a href="pt04ch04s03s05.html">Creating the editor plug-in</a></span></li></ul></li></ul></li><li><span class="file"><a href="rule_plugins.html">Rule plug-ins</a></span><ul><li><span class="file"><a href="html_rule_getShortInfo.html">getShortInfo</a></span></li><li><span class="file"><a href="pt04ch05s02.html">getLongInfo</a></span></li><li><span class="file"><a href="pt04ch05s03.html">getCheckIds</a></span></li><li><span class="file"><a href="pt04ch05s04.html">getCheckTitle</a></span></li><li><span class="file"><a href="pt04ch05s05.html">supportsAutoCorrection</a></span></li><li><span class="file"><a href="pt04ch05s06.html">getDefaultLogLevel</a></span></li><li><span class="file"><a href="pt04ch05s07.html">configure</a></span></li><li><span class="file"><a href="pt04ch05s08.html">startBatch</a></span></li><li><span class="file"><a href="pt04ch05s09.html">finishBatch</a></span></li><li><span class="file"><a href="html_rule_apply.html">apply</a></span></li><li><span class="file"><a href="my_html_rule_complete.html">The complete example</a></span></li><li><span class="file"><a href="pt04ch05s12.html">Creating the Rule Plug-in</a></span></li></ul></li><li><span class="file"><a href="autoformat_plugins.html">AutoFormat plug-ins</a></span><ul><li id="webhelp-currentid"><span class="file"><a href="pt04ch06s01.html">AutoFormat Transformations</a></span></li><li><span class="file"><a href="pt04ch06s02.html">AutoFormat Example</a></span></li><li><span class="file"><a href="pt04ch06s03.html">Creating an AutoFormat Plug-in</a></span></li></ul></li><li><span class="file"><a href="output_plugins.html">Output plug-ins</a></span></li><li><span class="file"><a href="customize_pdf_stylesheet.html">PDF stylesheet customization</a></span><ul><li><span class="file"><a href="customize_docbook_transformation.html">Customizing the transformation to DocBook</a></span></li><li><span class="file"><a href="pt04ch08s02.html">Customizing the DocBook stylesheets</a></span></li><li><span class="file"><a href="pt04ch08s03.html">Creating the stylesheet plug-in</a></span></li></ul></li></ul></div></div><div id="searchDiv"><div id="search"><form onsubmit="startWebHelpSearch(ditaSearch_Form);return false" name="ditaSearch_Form" class="searchForm"><fieldset class="searchFieldSet"><legend>Search</legend><div align="center"><input id="textToSearch" name="textToSearch" type="text" class="searchText"/>&nbsp;<input onclick="startWebHelpSearch(ditaSearch_Form)" type="button" class="searchButton" value="Go" id="doSearch"/></div></fieldset></form></div><div id="closeSearchResults" style="display:none"><a href="javascript:closeSearchShowToc();">Contents</a></div><div id="searchResults"><div align="center"></div></div></div></div></div>
<div id="bookpartsnavigation"><ul><li><a href="tutorial.html">Tutorial</a></li><li><a href="reference_manual.html">User Manual</a></li><li><a href="xhtml_reference.html">XHTML Reference</a></li><li class="book-currentpart"><a href="plugin_developer_guide.html">Plug-in Developer Guide</a></li></ul></div>
<div id="breadcrumbsnavigation" class="breadcrumbs"><span class="breadcrumb-link"><a class="breadcrumb_node" href="plugin_developer_guide.html">Plug-in Developer Guide</a></span> <span class="breadcrumb_separator">&rarr;</span> <span class="breadcrumb-link"><a class="breadcrumb_node" href="autoformat_plugins.html">AutoFormat plug-ins</a></span> <span class="breadcrumb_separator">&rarr;</span> <span class="breadcrumb_node breadcrumb_lastnode">AutoFormat Transformations</span></div>
<div id="content"><div id="comp00000049" class="section"><h3>4.6.1. AutoFormat Transformations</h3><div title="Intro, Examples" class="doc-content"><div class="normal-para">Docmenta allows users to create inline- and block-styles that authors can assign to content. On the XHTML source level, these user-defined styles represent CSS classes that are assigned to elements like <tt>div</tt>, <tt>span</tt> and others. For example, when an author selects words in the content-editor and assigns an inline-style with ID <tt>my_style</tt> to the selection, then following XHTML code is generated:</div>
<div class="normal-para indent-level1"><span class="xml_highlighted"><span class="code_tag">&lt;span </span><span class="code_attrib">class=</span><span class="code_attval">"my_style"</span><span class="code_tag">&gt;</span> </span><em>... selected words ... </em><span class="xml_highlighted"><span class="code_tag">&lt;/span&gt;</span></span></div>
<div class="normal-para">Accordingly, when an author selects one or more paragraphs or other block-elements and assigns a block-style with ID <tt>my_style</tt>, then for example following XHTML code is generated:</div>
<div class="normal-para indent-level1"><span class="xml_highlighted"><span class="code_tag">&lt;div </span><span class="code_attrib">class=</span><span class="code_attval">"my_style"</span><span class="code_tag">&gt;</span></span><br    />     <span class="xml_highlighted"><span class="code_tag">&lt;p&gt;</span><br    /></span>        <em>... first selected block ...</em> <br    />    <span class="xml_highlighted"><span class="code_tag">&lt;/p&gt;</span></span> <br    />    <span class="xml_highlighted"><span class="code_tag">&lt;div </span><span class="code_attrib">class=</span><span class="code_attval">"other_style"</span><span class="code_tag">&gt;</span></span><br    />         <em>... second selected block ...</em> <br    />    <span class="xml_highlighted"><span class="code_tag">&lt;/div&gt;</span></span> <br    />    <em>...</em> <br    /><span class="xml_highlighted"><span class="code_tag">&lt;/div&gt;</span></span></div>
<div class="normal-para">As you can see in the example above, elements can be nested: the block with style <tt>other_style</tt> is contained within the block with style <tt>my_style</tt>. </div>
<div class="normal-para">When you are working with XHTML and CSS, then a style is a set of CSS properties which define the font-size, font-color, background-color and so on. However, you cannot change the overall structure of a block just by changing the CSS properties of a style. For example, you cannot transform a simple paragraph into a table, by using CSS properties. To support such transformations in Docmenta, you can additionally assign one or more <em>Auto-Format classes</em> to a style. Basically an Auto-Format class is a piece of Java code that processes the element to which the style is assigned. Following are two examples of such transformations.</div>
<div class="header_para">
<div class="normal-para">Example 1</div>
</div>
<div class="normal-para">In the first example an Auto-Format transformation converts the input-element (highlighted in red) into a table with two rows. The first row is filled with the value of the input-element's title attribute and the second row is filled with the inner content of the input-element. Furthermore any nested <tt>p</tt> element is replaced by a <tt>&lt;br/&gt;</tt> element after the block (note that XHTML has to be generated; that is <tt>&lt;br/&gt;</tt> has to be generated instead of <tt>&lt;br&gt;</tt>). The following illustration gives an example of the described transformation, assuming that the transformation is assigned to a style with ID <tt>my_style1</tt>:</div>
<div class="normal-para"><div title="Auto-Format example 1" class="figure"><div class="mediaobject"><img src="images/auto_format_example1_32bit.png" alt="" width="680" style="print-width: 100%;" title="Auto-Format example 1"     /></div><p class="title">Figure 4.6.1. Auto-Format example 1</p></div></div>
<div class="header_para">
<div class="normal-para">Example 2</div>
</div>
<div class="normal-para">In the second example, an Auto-Format transformation just adds an inline image with alias name <tt>mypic</tt> to the beginning of the content. Following illustration gives an example, assuming that the transformation is assigned to a style with ID <tt>mystyle_2</tt>:</div>
<div class="normal-para"><div title="Auto-Format example 2" class="figure"><div class="mediaobject"><img src="images/auto_format_example2_32bit.png" alt="" width="680" style="print-width: 100%;" title="Auto-Format example 2"     /></div><p class="title">Figure 4.6.2. Auto-Format example 2</p></div></div>
<div class="normal-para">Note that in the second example, the outer <tt>div</tt>-block of the input is preserved in the result.</div>
</div><div title="Why" class="doc-content"><div class="header_para">
<div class="normal-para">Auto-Format use cases</div>
</div>
<div class="normal-para">Maybe somebody is wondering when to use Auto-Format transformations. Consider the situation, that you want to mark special paragraphs as warnings. For example, in the publication these paragraphs shall be highlighted with an exclamation icon. However, you might need differnt designs for different output formats, and if the design of warnings has to be changed in the future, you want to avoid having to update the content at each position where a warning exists. Furthermore, you want to assure that the same warning layout is used throughout the publication. In Docmenta these problems can be partially solved by using style-variants. This allows defining different style properties for the same style ID. Though, using style-variants is sufficient in many cases, you cannot change the overall layout of a block, just by changing the CSS properties of a style. For example, you cannot turn a simple box to become a table. However, such transformations can be done using Auto-Format classes. As an example of how to solve these issues with an Auto-Format class, see the example below, which implements a dynamic template mechanism.</div>
<div class="header_para">
<div class="normal-para">Why not use an XSLT processor?</div>
</div>
<div class="normal-para">An Auto-Format transformation can be implemented by using an XSLT processor. Docmenta includes the generic Auto-Format class <span class="code">org.docma.plugin.examples.XSLTAutoFormat</span> that allows to supply an XSLT script for input transformation. Though, for many simple transformations string operations might be sufficient. In general, you can use whatever you consider best, to implement an Auto-Format transformation. The only restriction is that it has to be possible to call it from within Java code.</div>
</div><div title="Export process" class="doc-content"><div class="header_para">
<div class="normal-para">The export process</div>
</div>
<div class="normal-para">Note that Auto-Format transformations are executed on the fly during publication export and during content preview. This means, the stored XHTML source is not modified by these transformations. For example, if an Auto-Format transformation inserts an inline image into the content (see example 2 above), the image only appears in the exported publication or when a preview of the content is rendered. But when the user edits the content, the inline image is <em>not</em> there.</div>
<div class="normal-para">So far we've just had a look to what a single transformation does. Now we'll take a look at the complete export process and see how the transformations interact in specific situations. The left side of the following illustration shows the XHTML source of a publication (only the elements are shown which are important for this example).</div>
<div class="normal-para"><div title="Export process (example)" class="figure"><div class="mediaobject"><img src="images/auto_format_export_32bit.png" alt="" title="Export process (example)"     /></div><p class="title">Figure 4.6.3. Export process (example)</p></div></div>
<div class="normal-para">The source content contains four elements, <tt>elem1</tt>, <tt>elem2</tt>, <tt>elem3</tt> and <tt>elem4</tt>, from which <tt>elem2</tt> and <tt>elem3</tt> are contained within <tt>elem1</tt>. The first element has the style <tt>mystyle_1</tt> assigned. The other elements have the style <tt>mystyle_2</tt> assigned. For this example, we assume that <tt>mystyle_1</tt> and <tt>mystyle_2</tt> have an Auto-Format transformation assigned as described in example 1 and 2 above.</div>
<div class="normal-para">During export and preview the source content is parsed top-down. As soon as an element is found which has an Auto-Format style assigned, this element is transformed. Therefore, in our example the first element to be transformed is <tt>elem1</tt>. The result of this transformation is a table with the element's title in the first row and the element's inner content in the second row. Furthermore the <tt>p</tt> element is replaced by a <tt>&lt;br /&gt;</tt>. Following illustration depicts the first transformation:</div>
<div class="normal-para"><div title="Export process (example, transformation 1)" class="figure"><div class="mediaobject"><img src="images/auto_format_export_t1_32bit.png" alt="" title="Export process (example, transformation 1)"     /></div><p class="title">Figure 4.6.4. Export process (example, transformation 1)</p></div></div>
<div class="normal-para">Now, the result of the first transformation is parsed again, to see if there are further Auto-Format styles to be processed. Actually, there is still the element <tt>elem2</tt> in the result, which has the style <tt>my_style2</tt> assigned. Therefore the second transformation is to transform <tt>elem2</tt>, as shown in the following illustration:</div>
<div class="normal-para"><div title="Export process (example, transformation 2)" class="figure"><div class="mediaobject"><img src="images/auto_format_export_t2_32bit.png" alt="" title="Export process (example, transformation 2)"     /></div><p class="title">Figure 4.6.5. Export process (example, transformation 2)</p></div></div>
<div class="normal-para">After this transformation, there are no more Auto-Format styles to be processed, and the parsing continues in the source content after the element <tt>elem1</tt>, i.e. the third transformation is the processing of element <tt>elem4</tt>. Note that element <tt>elem3</tt> is not transformed, because the <tt>p</tt> element was removed by the first transformation.</div>
<div class="normal-para">You might wonder why the transformation of <tt>elem2</tt> does not lead to an infinite loop, because the result of this transformation still contains the element <tt>&lt;span id="elem2" class="my_style2"&gt;</tt>, which originally caused the transformation. The reason is, that by default, the style which caused a transformation is <em>not</em> processed any more during the parsing of the transformation result. However, the Auto-Format API allows a programmer to disable this behavior by passing <span class="code">true</span> to the <tt>setStyleRecursion</tt> method of the <span class="code">org.docma.plugin.TransformationContext</span> instance (though, the recursion level is limited by the execution engine to avoid infinte loops).</div>
</div><div title="Piping" class="doc-content"><div class="header_para">
<div class="normal-para">Piping of transformations </div>
</div>
<div class="normal-para">In Docmenta it is possible to assign more than one Auto-Format transformation to a single style. If this is the case, then the output of the first transformation is used as input for the second transformation. If a third Auto-Format transformation is assigned to the style, then the output of the second transformation is used as input for the third transformation, and so on. The following illustration depicts this process:</div>
<div class="normal-para"><div title="Piping of transformations" class="figure"><div class="mediaobject"><img src="images/auto_format_piping_32bit.png" alt="" width="700" style="print-width:100%" title="Piping of transformations"     /></div><p class="title">Figure 4.6.6. Piping of transformations</p></div></div>
<div class="normal-para">As an example, consider the situation that you want to include program listings in your publications. The listings shall have line-numbers and the key-words of the programming language shall be highlighted. To solve this requirements without having to format the listings manually, you could create one Auto-Format transformation which adds line-numbers to the content, and a second Auto-Format transformation which highlights the keywords. Both transformations could be implemented completely independent of each other. To achieve the required formatting you could create a style, e.g. with ID <tt>listing</tt>, which has both transformations assigned. Following illustration depicts the transformation steps of an element which has the style <tt>listing</tt> assigned:</div>
<div class="normal-para"><div title="Auto-Format piping example" class="figure"><div class="mediaobject"><img src="images/auto_format_pipe_example_32bit.png" alt="" width="800" style="print-width: 100%;" title="Auto-Format piping example"     /></div><p class="title">Figure 4.6.7. Auto-Format piping example</p></div></div>
<div class="normal-para">The first transformation highlights keywords by enclosing them with <tt>span</tt> elements which have the style <tt>key</tt> assigned. The second piped transformation adds the line numbers. Note that the result of the first Auto-Format transformation is processed by the second piped Auto-Format transformation, even though the result does not contain any more Auto-Format styles to be processed (assuming that the style <tt>key</tt> has no Auto-Format transformation assigned). If the <tt>key</tt> style had an Auto-Format style assigned, then the <tt>span</tt> elements would be processed after the pipeline of transformations has been completely processed (assuming the <tt>span</tt> elements aren't removed by the piped transformations).</div>
<div class="normal-para">A special case occurs, if the result of a transformation does not contain a single root element. If a transformation produces more than one root element, then the following piped transformation will be applied to all root elements. If, on the other hand, a transformation does not return any XML element at all, e.g. it just returns a character string of type #PCDATA, then the following piped transformations will be skipped. This is because an Auto-Format transformation can only be applied to an XML input-element.</div></div></div><div class="navfooter"><hr/><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="autoformat_plugins.html"><span class="navlink-text">Prev</span></a>&#160;</td><td width="20%" align="center"><a accesskey="u" href="autoformat_plugins.html"><span class="navlink-text">Up</span></a></td><td width="40%" align="right">&#160;<a accesskey="n" href="pt04ch06s02.html"><span class="navlink-text">Next</span></a></td></tr><tr><td width="40%" align="left" valign="top">4.6. AutoFormat plug-ins&#160;</td><td width="20%" align="center"><a accesskey="h" href="index.html"><span class="navlink-text">Home</span></a></td><td width="40%" align="right" valign="top">&#160;4.6.2. AutoFormat Example</td></tr></table></div>
<div class="web_footer">
<p class="align-center">&#169; 2017 - www.docmenta.org</p>
</div>
</div>
<a id="showHideButton" onclick="showHideToc();" class="pointLeft" title="Hide TOC tree">&nbsp;</a></body>
</html>
