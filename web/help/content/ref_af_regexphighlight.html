<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
<head>
<!-- Put your custom HTML head tags here and select this file in the HTML output configuration. -->
<!-- Note: The content of this file has to be XML (XHTML). -->
<meta http-equiv="X-UA-Compatible" content="IE=8" />
<meta http-equiv="expires" content="43200" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<meta name="generator" content="Docmenta 1.9.0"/>
<title>2.8.3. org.docma.plugin.examples.RegExpHighlight</title>
<link rel="shortcut icon" href="favicon.ico" type="image/x-icon"/>
<link rel="home" href="index.html" title="Docmenta Tutorial and Reference"/>
<link rel="up" href="ref_autoformat_classes.html" title="2.8. Auto-Format Class Reference"/>
<link rel="prev" href="ref_af_formatlines.html" title="2.8.2. org.docma.plugin.examples.FormatLines"/>
<link rel="prev" href="ref_af_xsltautoformat.html" title="2.8.4. org.docma.plugin.examples.XSLTAutoFormat"/>
<link rel="stylesheet" type="text/css" href="styles.css"/>
<link rel="stylesheet" type="text/css" href="common/jquery/theme-redmond/jquery-ui-1.8.2.custom.css"/>
<link rel="stylesheet" type="text/css" href="common/jquery/treeview/jquery.treeview.css"/>
<link rel="stylesheet" type="text/css" href="common/css/positioning.css"/>
<script type="text/javascript">
  var treeCookieId = "treeview-1494620492739";
  var language = "en";
  var w = new Object();
  txt_filesfound = "Results";
  txt_enter_at_least_1_char = "You must enter at least one character.";
  txt_browser_not_supported = "Your browser is not supported. Use of Mozilla Firefox is recommended.";
  txt_please_wait = "Please wait. Search in progress...";
  txt_results_for = "Results for: ";
</script>
<script type="text/javascript" src="common/jquery/jquery-1.4.2.min.js"></script>
<script type="text/javascript" src="common/jquery/jquery-ui-1.8.2.custom.min.js"></script>
<script type="text/javascript" src="common/jquery/jquery.cookie.js"></script>
<script type="text/javascript" src="common/jquery/treeview/jquery.treeview.min.js"></script>
<script type="text/javascript" src="search/htmlFileList.js"></script>
<script type="text/javascript" src="search/htmlFileInfoList.js"></script>
<script type="text/javascript" src="search/nwSearchFnt.js"></script>
<script type="text/javascript" src="search/stemmers/en_stemmer.js"></script>
<script type="text/javascript" src="search/index-1.js"></script>
<script type="text/javascript" src="search/index-2.js"></script>
<script type="text/javascript" src="search/index-3.js"></script>
<script type="text/javascript" src="custom.js"></script>
<script type="text/javascript" src="common/main.js"></script>
</head>
<body>
<div id="header"><img id="webhelplogo1" align="left" src='common/images/logo1.png' alt="Logo"/><img id="webhelplogo2" align="right" src='common/images/logo2.png' alt="Logo"/><div class="webhelptitle"><div class="webhelptitle1">Chapter 2.8. Auto-Format Class Reference</div><div class="webhelptitle2">2.8.3. org.docma.plugin.examples.RegExpHighlight</div></div><div id="navheader" align="right"><table><tr><td><img src="common/images/highlight-blue.gif" alt="H" onclick="toggleHighlight()" id="showHideHighlight" title="Toggle search result highlighting" /></td><td><a id="navhead-prev" accesskey="p" href="ref_af_formatlines.html"><span class="navlink-text">Prev</span></a><span class="navhead-separator">&nbsp;|&nbsp;</span><a id="navhead-up" accesskey="u" href="ref_autoformat_classes.html"><span class="navlink-text">Up</span></a><span class="navhead-separator">&nbsp;|&nbsp;</span><a id="navhead-next" accesskey="n" href="ref_af_xsltautoformat.html"><span class="navlink-text">Next</span></a></td></tr></table></div></div>
<div id="leftnavigation"><div id="tabs"><ul id="tocsearchnavigation" style="display:none"><li id="tocnavigationtab"><a href="#treeDiv"><em>Contents</em></a></li><li id="searchnavigationtab"><a href="#searchDiv"><em>Search</em></a></li></ul><div id="treeDiv"><img src="common/images/loading.gif" alt="loading table of contents..." id="tocLoading" style="display:block;"/><div id="ulTreeDiv" style="display:none;"><div id="treenavigationtitle" style="display:none;">Contents</div><ul id="tree" class="filetree"><li><span class="file"><a href="install_instructions.html">Installation</a></span><ul><li><span class="file"><a href="install_requirements.html">Requirements</a></span></li><li><span class="file"><a href="install_download.html">Download</a></span></li><li><span class="file"><a href="install_package.html">Package installation</a></span><ul><li><span class="file"><a href="install_war.html">Installing the war package</a></span></li><li><span class="file"><a href="install_zip.html">Installing the Docmenta+Tomcat zip package</a></span></li><li><span class="file"><a href="install_winexe.html">Installing the Windows installer package</a></span></li><li><span class="file"><a href="install_upgrade.html">Upgrading</a></span></li></ul></li><li><span class="file"><a href="install_setup.html">Setup</a></span></li></ul></li><li><span class="file"><a href="main_window.html">Main window</a></span></li><li><span class="file"><a href="content_workspace.html">Content workspace</a></span><ul><li><span class="file"><a href="product_tree.html">Product-tree</a></span></li><li><span class="file"><a href="root_folders.html">Root folders</a></span></li><li><span class="file"><a href="node_types.html">Node types</a></span><ul><li><span class="file"><a href="section_nodes.html">Section-nodes</a></span></li><li><span class="file"><a href="pt02ch03s03s02.html">Content-nodes</a></span></li><li><span class="file"><a href="image_file.html">Image-files</a></span></li><li><span class="file"><a href="data_file.html">Data-file</a></span></li><li><span class="file"><a href="inclusion_nodes.html">Inclusion-nodes</a></span></li><li><span class="file"><a href="image_folder.html">Image-folder</a></span></li><li><span class="file"><a href="file_folder.html">File-folder</a></span></li></ul></li><li><span class="file"><a href="content_context_menu.html">Context menu</a></span><ul><li><span class="file"><a href="insert_edit_nodes.html">Inserting and editing nodes</a></span></li><li><span class="file"><a href="cut_paste_delete.html">Cut, copy, paste and delete</a></span></li><li><span class="file"><a href="preview_pdf.html">Preview PDF</a></span></li><li><span class="file"><a href="upload_download.html">File upload and download</a></span></li><li><span class="file"><a href="compare_versions.html">Revision history</a></span></li><li><span class="file"><a href="search_replace.html">Searching and replacing text</a></span></li><li><span class="file"><a href="find_nodes.html">Finding nodes</a></span></li><li><span class="file"><a href="consistency_check.html">Consistency-Check</a></span></li></ul></li><li><span class="file"><a href="translating_nodes.html">Translating nodes</a></span></li><li><span class="file"><a href="gentext_config.html">Gentext configuration</a></span></li><li><span class="file"><a href="content_toolbar.html">Toolbar</a></span></li><li><span class="file"><a href="content_editor.html">Editing content</a></span><ul><li><span class="file"><a href="basic_editing.html">Basic editing</a></span></li><li><span class="file"><a href="apply_styles.html">Applying styles</a></span></li><li><span class="file"><a href="pt02ch03s08s03.html">Aligning paragraphs</a></span></li><li><span class="file"><a href="indent_para.html">Indenting paragraphs</a></span></li><li><span class="file"><a href="list_element.html">Lists</a></span></li><li><span class="file"><a href="table_element.html">Tables</a></span></li><li><span class="file"><a href="image_element.html">Images</a></span></li><li><span class="file"><a href="link_element.html">Links</a></span></li><li><span class="file"><a href="quick_links.html">Quick-Links</a></span></li><li><span class="file"><a href="anchors.html">Anchors</a></span></li><li><span class="file"><a href="special_chars.html">Special characters</a></span><ul><li><span class="file"><a href="insert_char_entity.html">Character entities</a></span></li><li><span class="file"><a href="pt02ch03s08s11s02.html">Non-breaking space</a></span></li></ul></li><li><span class="file"><a href="insert_template_content.html">Templates</a></span></li><li><span class="file"><a href="html_source.html">Editing the HTML source</a></span></li><li><span class="file"><a href="page_breaks.html">Controlling page breaks</a></span><ul><li><span class="file"><a href="pt02ch03s08s14s01.html">Hard page breaks</a></span></li><li><span class="file"><a href="pt02ch03s08s14s02.html">Soft page breaks</a></span></li><li><span class="file"><a href="pt02ch03s08s14s03.html">Keep together blocks</a></span></li></ul></li></ul></li></ul></li><li><span class="file"><a href="styles_workspace.html">Styles workspace</a></span><ul><li><span class="file"><a href="inline_block_styles.html">Inline- and block styles</a></span></li><li><span class="file"><a href="predefined_styles.html">Pre-defined styles</a></span></li><li><span class="file"><a href="user_defined_styles.html">Creating a user-defined style</a></span></li><li><span class="file"><a href="edit_style.html">Editing styles</a></span></li><li><span class="file"><a href="delete_styles.html">Deleting styles</a></span></li><li><span class="file"><a href="using_style_variants.html">Using style variants</a></span></li><li><span class="file"><a href="style_variants.html">Creating a style variant</a></span></li><li><span class="file"><a href="export_styles.html">Exporting styles</a></span></li><li><span class="file"><a href="import_styles.html">Importing styles</a></span></li></ul></li><li><span class="file"><a href="versioning_workspace.html">Versioning workspace</a></span><ul><li><span class="file"><a href="versioning_concept.html">Versioning concept</a></span></li><li><span class="file"><a href="create_product_version.html">Creating a new version</a></span></li><li><span class="file"><a href="release_product_version.html">Releasing a version</a></span></li><li><span class="file"><a href="unrelease_product_version.html">Unreleasing a version</a></span></li><li><span class="file"><a href="rename_product_version.html">Renaming a version</a></span></li><li><span class="file"><a href="delete_product_version.html">Deleting a version</a></span></li><li><span class="file"><a href="clear_revisions.html">Clear revisions</a></span></li><li><span class="file"><a href="show_connected_users.html">Show connected users</a></span></li></ul></li><li><span class="file"><a href="publishing_workspace.html">Publishing workspace</a></span><ul><li><span class="file"><a href="publication_configuration.html">Publication configuration</a></span><ul><li><span class="file"><a href="create_publication_config.html">Creating a publication configuration</a></span></li><li><span class="file"><a href="edit_publication_config.html">Editing a publication configuration</a></span></li><li><span class="file"><a href="delete_publication_config.html">Deleting a publication configuration</a></span></li><li><span class="file"><a href="copy_publication_config.html">Copying a publication configuration</a></span></li></ul></li><li><span class="file"><a href="output_configuration.html">Output configuration</a></span><ul><li><span class="file"><a href="edit_output_config.html">Editing an output configuration</a></span><ul><li><span class="file"><a href="out_config_general.html">General output settings</a></span></li><li><span class="file"><a href="out_config_numbering.html">Numbering settings</a></span></li><li><span class="file"><a href="out_config_html.html">HTML output settings</a></span></li><li><span class="file"><a href="out_config_pdf.html">PDF output settings</a></span></li><li><span class="file"><a href="out_config_header_footer.html">Header/Footer settings</a></span></li></ul></li><li><span class="file"><a href="create_output_config.html">Creating an output configuration</a></span></li><li><span class="file"><a href="delete_output_config.html">Deleting an output configuration</a></span></li><li><span class="file"><a href="copy_output_config.html">Copying an output configuration</a></span></li></ul></li><li><span class="file"><a href="publication_export.html">Publication export</a></span><ul><li><span class="file"><a href="start_publication_export.html">Starting a new export</a></span></li><li><span class="file"><a href="show_export_queue.html">The export queue</a></span></li><li><span class="file"><a href="edit_publication_export.html">Editing an export</a></span></li><li><span class="file"><a href="delete_publication_export.html">Deleting an export</a></span></li></ul></li><li><span class="file"><a href="applic_configuration.html">Applicability configuration</a></span></li></ul></li><li><span class="file"><a href="administration_workspace.html">Administration workspace</a></span><ul><li><span class="file"><a href="manage_products.html">Managing products</a></span><ul><li><span class="file"><a href="storage_types.html">Storage types</a></span><ul><li><span class="file"><a href="storage_type_fs.html">Filesystem Storage</a></span></li><li><span class="file"><a href="storage_type_external_db.html">External Database Storage</a></span></li><li><span class="file"><a href="storage_type_embedded_db.html">Embedded Database Storage</a></span></li></ul></li><li><span class="file"><a href="create_product.html">Creating a new product</a></span><ul><li><span class="file"><a href="product_configuration_filesystem.html">Filesystem product configuration</a></span></li><li><span class="file"><a href="product_configuration_embedded_db.html">Embedded-database product configuration</a></span></li><li><span class="file"><a href="product_configuration_database.html">Database product configuration</a></span></li></ul></li><li><span class="file"><a href="add_product.html">Adding a product</a></span></li><li><span class="file"><a href="edit_product.html">Editing a product</a></span></li><li><span class="file"><a href="delete_product.html">Deleting a product</a></span></li><li><span class="file"><a href="copy_product.html">Copying a product</a></span></li><li><span class="file"><a href="disable_enable_product.html">Disabling and enabling products</a></span></li></ul></li><li><span class="file"><a href="manage_users.html">Managing users</a></span><ul><li><span class="file"><a href="create_user.html">Creating new users</a></span></li><li><span class="file"><a href="edit_user.html">Editing the user profile</a></span></li><li><span class="file"><a href="delete_user.html">Deleting users</a></span></li></ul></li><li><span class="file"><a href="manage_usergroups.html">Managing user groups</a></span><ul><li><span class="file"><a href="user_groups.html">User groups</a></span></li><li><span class="file"><a href="access_rights.html">Access rights</a></span></li><li><span class="file"><a href="members.html">Members</a></span></li></ul></li><li><span class="file"><a href="configure_char_entities.html">Defining character entities</a></span></li><li><span class="file"><a href="manage_plugins.html">Installing Plug-ins</a></span></li><li><span class="file"><a href="rule_config.html">Rule configuration</a></span><ul><li><span class="file"><a href="pt02ch07s06s01.html">Pre-defined rules</a></span></li><li><span class="file"><a href="rule_config_edit.html">Editing the rule configuration</a></span></li><li><span class="file"><a href="pt02ch07s06s03.html">Adding new rules</a></span></li></ul></li><li><span class="file"><a href="autoformat_config.html">Auto-Format class registration</a></span></li><li><span class="file"><a href="app_settings.html">Application settings</a></span></li></ul></li><li><span class="file"><a href="ref_autoformat_classes.html">Auto-Format Class Reference</a></span><ul><li><span class="file"><a href="ref_af_applytemplate.html">org.docma.plugin.examples.ApplyTemplate</a></span></li><li><span class="file"><a href="ref_af_formatlines.html">org.docma.plugin.examples.FormatLines</a></span></li><li id="webhelp-currentid"><span class="file"><a href="ref_af_regexphighlight.html">org.docma.plugin.examples.RegExpHighlight</a></span></li><li><span class="file"><a href="ref_af_xsltautoformat.html">org.docma.plugin.examples.XSLTAutoFormat</a></span></li></ul></li></ul></div></div><div id="searchDiv"><div id="search"><form onsubmit="startWebHelpSearch(ditaSearch_Form);return false" name="ditaSearch_Form" class="searchForm"><fieldset class="searchFieldSet"><legend>Search</legend><div align="center"><input id="textToSearch" name="textToSearch" type="text" class="searchText"/>&nbsp;<input onclick="startWebHelpSearch(ditaSearch_Form)" type="button" class="searchButton" value="Go" id="doSearch"/></div></fieldset></form></div><div id="closeSearchResults" style="display:none"><a href="javascript:closeSearchShowToc();">Contents</a></div><div id="searchResults"><div align="center"></div></div></div></div></div>
<div id="bookpartsnavigation"><ul><li><a href="tutorial.html">Tutorial</a></li><li class="book-currentpart"><a href="reference_manual.html">User Manual</a></li><li><a href="xhtml_reference.html">XHTML Reference</a></li><li><a href="plugin_developer_guide.html">Plug-in Developer Guide</a></li></ul></div>
<div id="breadcrumbsnavigation" class="breadcrumbs"><span class="breadcrumb-link"><a class="breadcrumb_node" href="reference_manual.html">User Manual</a></span> <span class="breadcrumb_separator">&rarr;</span> <span class="breadcrumb-link"><a class="breadcrumb_node" href="ref_autoformat_classes.html">Auto-Format Class Reference</a></span> <span class="breadcrumb_separator">&rarr;</span> <span class="breadcrumb_node breadcrumb_lastnode">org.docma.plugin.examples.RegExpHighlight</span></div>
<div id="content"><div id="ref_af_regexphighlight" class="section"><h3>2.8.3. org.docma.plugin.examples.RegExpHighlight</h3><div title="RegExpHighlight Reference" class="doc-content"><div class="header_para">
<div class="normal-para"><big><strong>Arguments:</strong></big></div>
</div>
<dl><dt><strong><tt>cfg=<em>FILE_ALIAS</em></tt></strong></dt><dd>The highlight configuration. <tt><em>FILE_ALIAS</em></tt> has to be the alias name of a text-file containing the highlight configuration. The highlight configuration format is described below. This argument is mandatory.</dd><dt><strong><tt>decode=[true|false]</tt></strong></dt><dd>Character entity decoding behavior. If the <tt>decode</tt> argument is set to <tt>true</tt>, then character entities are decoded before regular-expression based pattern matching is applied. Otherwise character entities are not decoded. The <tt>decode</tt> argument is optional. If not specified, the default setting is <tt>true</tt>.</dd><dt><strong><tt>skipargs=[true|false]</tt></strong></dt><dd>This argument is used in combination with the Auto-Format class <tt>org.docma.plugin.examples.FormatLines</tt>. If the <tt>skipargs</tt> argument is set to <tt>true</tt>, then the first line is not highlighted, if it starts with the string "<tt>[args:</tt>", i.e. if it's an argument line which needs to be processed by the class <tt>org.docma.plugin.examples.FormatLines</tt>. If not specified, the default setting is <tt>true</tt>.</dd></dl>
<div class="header_para">
<div class="normal-para"><big><strong>General</strong></big></div>
</div>
<div class="normal-para">The highlight configuration has to be provided as text-file. The alias name of the text-file has to be passed in the argument <tt>cfg</tt>. The highlight configuration defines one or more regular-expressions and assigns them to inline-styles. This configuration is used during transformation to highlight parts of the content. If some part of the input matches one of the regular-expressions, then this part is formatted with the style assigned to the matching regular-expression.</div>
<div class="normal-para">Please note, that the transformation does <em>not</em> remove or change styles which already exist in the input. Therefore, if the highlight transformation does not give a 100% correct result, the user can fix this by manually applying the correct formatting to the incorrectly formatted content.</div>
<div class="header_para">
<div class="normal-para"><big><strong>Highlight rules</strong></big></div>
</div>
<div class="normal-para">A highlight rule is a line in the format:</div>
<div class="normal-para code_listing"><em>STYLE_ID</em>[, <em>STYLE_ID</em>, ...] : <em>REGULAR_EXPRESSION</em></div>
<div class="normal-para">i.e. a highlight rule starts with a comma separated list of one or more style-IDs, followed by a colon, followed by a regular expression. Content that matches the regular-expression is formatted with the first style given in the comma separated list of styles. If the regular-expression contains capturing groups, then the content that matches the first group is formatted with the second style in the comma separated list. Content that matches the second group is formatted with the third style in the list, and so on. Note that the style-IDs may be placed on separate lines, but the regular expression has to be placed on the same line as the colon.</div>
<div class="normal-para">The regular-expression implementation of the Standard Java Platform is used for pattern matching. For details on the regular-expression syntax, see the documentation of the class <tt>java.util.regex.Pattern</tt> in the Java Platform API specification. Please note that the regular expressions are compiled with the flags <tt>DOTALL</tt> and <tt>MULTILINE</tt>. Therefore the dot character (.) matches any character, including a line terminator, and the boundary matchers ^ and $ match just after/before a line terminator or the beginning/end of the input sequence.</div>
<div class="normal-para"><strong>Example 1:</strong> <br    />If following highlight rule is given,</div>
<div class="normal-para code_listing">my_style : ABB?A</div>
<div class="normal-para">then the input sequence <tt>AABABABBA</tt> is formatted as follows:</div>
<div class="normal-para code_listing">A&lt;span class="my_style"&gt;ABA&lt;/span&gt;B&lt;span class="my_style"&gt;ABBA&lt;/span&gt;</div>
<div class="normal-para"><strong>Example 2:</strong> <br    />If following highlight rule is given:</div>
<div class="normal-para code_listing">my_style, b_style : A(B*)C</div>
<div class="normal-para">then the input sequence <tt>ABBC</tt> is transformed to</div>
<div class="normal-para code_listing">&lt;span class="my_style"&gt;A&lt;span class="b_style"&gt;BB&lt;/span&gt;C&lt;/span&gt;</div>
<div class="normal-para">Note that the style with ID <tt>b_style</tt> is only applied if the corresponding group <tt>(B*)</tt> actually matches some part of the input. For example, given the highlight configuration above, the input sequence <tt>AACA</tt> is transformed to</div>
<div class="normal-para code_listing">A&lt;span class="my_style"&gt;AC&lt;/span&gt;A</div>
<div class="normal-para">i.e. the style <tt>style_b</tt> is not applied because the group <tt>(B*)</tt> does not match anything.</div>
<div class="header_para">
<div class="normal-para"><big><strong>Multiple highlight rules</strong></big></div>
</div>
<div class="normal-para">A highlight configuration can consist of an arbitrary number of highlight rules. If more than one regular expression matches some part of the content, then the highlight rule which has the nearest match is applied. If multiple highlight rules match parts that start at the same position, then the highlight rule that is defined first is applied. For example, given following highlight rules:</div>
<div class="normal-para code_listing">b_style : BC<br    /> a_style : AB<br    /> c_style : ..C</div>
<div class="normal-para">If the input sequence <tt>ABC</tt> is transformed with this configuration, the result is:</div>
<div class="normal-para code_listing">&lt;span class="a_style"&gt;AB&lt;/span&gt;C</div>
<div class="normal-para">Though all three regular-expressions match some part of the input, the style <tt>a_style</tt> is actually applied. The style <tt>b_style</tt> is not applied, because the part matched by the regular-expression <tt>BC</tt> is located after the parts matched by the other two regular expressions. The style <tt>c_style</tt> is not applied, because the corresponding highlight definition is defined after the highlight definition of style <tt>a_style</tt>.</div>
<div class="header_para">
<div class="normal-para"><big><strong>Non-highlighted groups</strong></big></div>
</div>
<div class="normal-para">If a capturing group shall not be highlighted, then the style ID can be omitted in the comma separated list. For example, given following configuration:</div>
<div class="normal-para code_listing">my_style,,c_style : A(B(C))</div>
<div class="normal-para">If the input <tt>ABC</tt> is transformed with this configuration, the result is:</div>
<div class="normal-para code_listing">&lt;span class="my_style"&gt;AB&lt;span class="c_style"&gt;C&lt;/span&gt;&lt;/span&gt;</div>
<div class="normal-para">Alternatively, the non-capturing group construct <tt>(?:</tt> ... <tt>)</tt> can be used, i.e. the following highlight configuration produces the same result as the previous configuration:</div>
<div class="normal-para code_listing">my_style, c_style : A(?:B(C))</div>
<div class="header_para">
<div class="normal-para"><big><strong>Constant definitions</strong></big></div>
</div>
<div class="normal-para">Regular expressions can become very complex and lengthy. Furthermore, often the same expression has to be repeated several times. To avoid such redundancy and to improve readability, regular-expression constants can be defined. Once a regular expression constant is defined, it can be used in subsequent highlight definitions. A constant definition has the format:</div>
<div class="normal-para code_listing">%<em>NAME</em>% : <em>REGULAR_EXPRESSION</em></div>
<div class="normal-para">See the complete example below on how to use regular-expression constants.</div>
<div class="header_para">
<div class="normal-para"><big><strong>Comment lines</strong></big></div>
</div>
<div class="normal-para">A line that starts with a # character is interpreted as a comment (i.e. the line is ignored). Comments should be used to document the highlight configuration, e.g. describe what a regular expression is intended for. See the complete example below on how to use comment lines.</div>
<div class="header_para">
<div class="normal-para"><big><strong>States</strong></big></div>
</div>
<div class="normal-para">Since Docmenta version 1.8, the regular expression based syntax highlighting supports the concept of a state machine: The current state defines which set of rules is applied to the currently processed part of the input. During parsing of the input, the state machine can change its state, depending on the regular expression rule that matches the current part of the input.</div>
<div class="normal-para">A state is declared by a line starting with the :: operator, followed by the name of the state. All highlight rules that follow this line (up to the end of the file or up to the next line starting with ::) are rules that belong to this state. Example:</div>
<div class="normal-para code_listing">::A_OR_B<br    /> a_style : A+<br    /> b_style : B+<br    />  <br    /> ::STATE_C<br    /> c_style : CD*</div>
<div class="normal-para">In the example above, the states with name <tt>A_OR_B</tt> and <tt>STATE_C</tt> exist. The first two rules (<tt>a_style</tt> and <tt>b_style</tt>) belong to state <tt>A_OR_B</tt> and the third rule belongs to <tt>STATE_C</tt>.</div>
<div class="normal-para">Note that state names are case-sensitive. By convention, state names should be written in upper-case letters.</div>
<div class="header_para">
<div class="normal-para"><big><strong>State transitions</strong></big></div>
</div>
<div class="normal-para">Defining multiple states only makes sense, if the state can transition from one state to another. A state transition can be defined for a reguar expression rule, by adding a line that start with the <tt>-&gt;</tt> operator directly after the regular expression rule. Given the example above, if the state shall change from <tt>A_OR_B</tt> to <tt>STATE_C</tt>, in case the regular expression <tt>A+</tt> is matched, then the configuration has to be adapted as follows:</div>
<div class="normal-para code_listing">::A_OR_B<br    /> a_style : A+<br    />  -&gt; STATE_C<br    /> b_style : B+<br    />  <br    /> ::STATE_C<br    /> c_style : CD*</div>
<div class="normal-para">If no state transition is defined, as it is the case for the rules <tt>b_style:B+</tt> and <tt>c_style:CD*</tt>, then the state machine remains in the current state.</div>
<div class="header_para">
<div class="normal-para"><big><strong>Return states</strong></big></div>
</div>
<div class="normal-para">A state can transition from different source states to the same target state. In this case it is sometimes required to return to the source state. This can be achieved by using the notation "<tt>-&gt; enter(<em>target_state</em>)</tt>" for the transition to the target-state, and the notation "<tt>-&gt; return()</tt>" for the returning transition. Example:</div>
<div class="normal-para code_listing">::A_OR_B <br    />a_style : A+<br    />  -&gt; enter(STATE_X)<br    /> b_style : B+<br    />  -&gt; STATE_C<br    />   <br    /> ::STATE_C<br    /> c_style : C<br    />  -&gt; enter(STATE_X)<br    />   <br    /> ::STATE_X<br    /> x_style : X+<br    />  -&gt; return()</div>
<div class="normal-para">In the example above, after <tt>STATE_X</tt> has been entered, the next state may be either <tt>A_OR_B</tt> or <tt>STATE_C</tt>, depending from where <tt>STATE_X</tt> has been entered.</div>
<div class="normal-para">Sometimes it may be required to return to a different state, than the source-state. This can be achieved by using the notation "<tt>-&gt; enter(<em>target_state</em>, returnState:<em>return_state</em>)</tt>". Given the example above, if the <tt>STATE_C</tt> rule is changed to</div>
<div class="normal-para code_listing">::STATE_C<br    /> c_style : C<br    />  -&gt; enter(STATE_X, returnState: A_OR_B)</div>
<div class="normal-para">then the state to which will be returned is <tt>A_OR_B</tt> instead of <tt>STATE_C</tt>.</div>
<div class="header_para">
<div class="normal-para"><big><strong>The initial state</strong></big></div>
</div>
<div class="normal-para">For each highlight configuration one state is the so called initial state. This is the state of the state machine, when parsing of the input starts. The initial state is always the first state that is declared in the configuration file. Given the example above, <tt>A_OR_B</tt> is the initial state because its declared before the state <tt>STATE_C</tt>.</div>
<div class="normal-para">Be aware that states imported via the <tt>@import</tt> command (see below) are <em>not</em> considered to be initial states, even if the import command is inserted before the first state declaration. If you want the initial state to be a state declared in an imported configuration, you need to declare a forwarding state as the first state in the configuration. A forwarding state just forwards to another state, e.g. to an imported state or to another state declared in the same file. For details see the section "Forwarding States" below.</div>
<div class="normal-para">Note that for backwards compatibility, a state does not necessarily have to be declared. If a regular expression rule is defined, but no state has been explicitly declared (e.g. in case of highlight configuration files created before the state machine concept has been introduced), then the rules belong to the implicit state named <tt>START</tt>. Nevertheless, since the concept of a state machine has been introduced, it is recommended to assign all highlight rules to an explicitly declared state.</div>
<div class="header_para">
<div class="normal-para"><big><strong>Forwarding States</strong></big></div>
</div>
<div class="normal-para">A forwarding state is a state that has no regular expression rules assigned, but immediately forwards to another state. A forwarding state is declared as follows:</div>
<div class="normal-para code_listing">::<em>SOURCE</em> -&gt; <em>TARGET</em></div>
<div class="normal-para">where <tt><em>SOURCE</em></tt> is the name of the forwarding state to be declared, and <tt><em>TARGET</em></tt> is the name of another state to which this state shall be forwarded. Example:</div>
<div class="normal-para code_listing">::START -&gt; B_OR_C<br    />  <br    /> ::STATE_A<br    /> a_style : A+<br    />  <br    /> ::B_OR_C<br    /> b_style : B+<br    /> c_style : CD*</div>
<div class="normal-para">In the example above, the state <tt>START</tt> is the initial state, because it's the first declared state. However, effectively the rules of state <tt>B_OR_C</tt> are the first rules applied to the input, because <tt>START</tt> just forwards to <tt>B_OR_C</tt>. Forwarding states can improve readability and maintainability of the configuration files.</div>
<div class="header_para">
<div class="normal-para"><big><strong>Import command</strong></big></div>
</div>
<div class="normal-para">Sometimes it may be useful to reuse existing highlight configurations. For example, if you have an existing highlight configuration for HTML code and you have an existing highlight configuration for JAVA code, then you could reuse these configurations when you create a highlight configuration for Java Server Pages (JSP) code.</div>
<div class="normal-para">You can import an existing highlight configuration by inserting following line in your configuration:</div>
<div class="normal-para code_listing">@import(<em>alias</em>)</div>
<div class="normal-para">where <tt><em>alias</em></tt> is the alias name of the configuration to be imported. Importing a configuration makes all states and constants defined in the imported configuration visible to the file that contains the import command.</div>
<div class="header_para">
<div class="normal-para"><big><strong>State Priority, Extending state definitions</strong></big></div>
</div>
<div class="normal-para">When states are imported via the import command (see above), it can become necessary to extend or overwrite imported state definitions. This can be achieved by declaring a state which has the same name than an imported state. If a state is declared that has the same name than a previously declared state, then following cases need to be considered: the previously declared state has</div>
<ol>
<li>the same priority,</li>
<li>higher or lower priority</li>
</ol>
<div class="normal-para">than the newly declared state. If equally named state definitions have the same priority, then all regular expression rules defined for these definitions are merged (i.e. all rules defined for all these state definitions are applied).</div>
<div class="normal-para">If a state definition has lower priority than another equally named state definition, then the rules defined for the state with lower priority are ignored. Or the other way round: the state with higher priority replaces any equally named state with lower priority.</div>
<div class="normal-para">If no priority is explicitly assigned, then all states have the default priority 1. To declare a state with a priority other than the default priority, following declaration has to be used :</div>
<div class="normal-para code_listing">::<em>STATE_NAME</em>(priority:<em>x</em>)</div>
<div class="normal-para">where <tt><em>STATE_NAME</em></tt> is the name of the state to be declared, and <tt><em>x</em></tt> is the priority given as integer number. Note that the higher the number the higher the priority. Example:</div>
<div class="normal-para code_listing">::STATE_A<br    /> a_style : A+<br    />  <br    /> ::B_OR_C<br    /> b_style : B+<br    />  <br    /> ::STATE_A(priority:2)<br    /> aa_style : AA+<br    />  <br    /> ::B_OR_C<br    /> c_style : CD*</div>
<div class="normal-para">In the example above, two states are defined. The state <tt>STATE_A</tt> has effectively one rule assigned, which is <tt>aa_style:AA+</tt>. Note that the rule <tt>a_style:A+</tt> is ignored because it has the default priority 1, which is lower than priority 2 of the second <tt>STATE_A</tt> definition. The state <tt>B_OR_C</tt> has effectively two rules assigned, namely <tt>b_style:B+</tt> and <tt>c_style:CD*</tt>, because the rules of both state definitions have the same priority (the default priority 1).</div>
<div class="header_para">
<div class="normal-para"><big><strong>Regular expression hints</strong></big></div>
</div>
<div class="normal-para"><strong>Greedy vs. reluctant quantifiers</strong> <br    />If, for example, the quantifiers <tt>?</tt>, <tt>*</tt>, <tt>+</tt> or <tt>{<em>n,m</em>}</tt> are used, then the matching behavior is greedy, i.e. the matching algorithm consumes as much characters as possible. For example, given following highlight configuration:</div>
<div class="normal-para code_listing">my_style : A.*C</div>
<div class="normal-para">If the input sequence <tt>ABCC</tt> is transformed with this configuration, then the result is:</div>
<div class="normal-para code_listing">&lt;span class="my_style"&gt;ABCC&lt;/span&gt;</div>
<div class="normal-para">This behaviour can be changed by using a reluctant quantifier, e.g. <tt>*?</tt> instead of <tt>*</tt>. For example if the regular expression is changed to <tt>A.*?C</tt>, then the result is:</div>
<div class="normal-para code_listing">&lt;span class="my_style"&gt;ABC&lt;/span&gt;C</div>
<div class="normal-para"><strong>Quantified groups</strong> <br    />If a capturing group matches several times due to a quantifier applied to the group, then only the last match is formatted with the assigned style. For example, given following highlight configuration:</div>
<div class="normal-para code_listing">,b_style : A(B)+</div>
<div class="normal-para">If the input sequence <tt>ABB</tt> is transformed with this configuration, then the result is:</div>
<div class="normal-para code_listing">AB&lt;span class="b_style"&gt;B&lt;/span&gt;</div>
<div class="normal-para">Unfortunately this behaviour is due to a limitation of the Java regular expression API. If you want all <tt>B</tt> characters to be formatted with the style <tt>b_style</tt>, then the regular-expression has to be changed to <tt>A(B+)</tt>. However, this solution is not always appropriate. For example, if you have the regular-expression <tt>((A)(B))+</tt> and you want to assign different styles to <tt>A</tt> and <tt>B</tt>, then the configuration</div>
<div class="normal-para code_listing">,,a_style,b_style : ((A)(B))+</div>
<div class="normal-para">does not work. For example, if you have the input <tt>ABAB</tt>, then only the last <tt>A</tt> and <tt>B</tt> is highlighted. If you know the maximum number of repetitions, then a workaround is to explicitely repeat the group and use the quantifier ? instead of +. For example, if you know that the sequence AB is repeated at most once, then the configuration can be changed to:</div>
<div class="normal-para code_listing">,a_style,b_style,,a_style,b_style : (A)(B)((A)(B))?</div>
<div class="normal-para">Note: The usage of states can help to avoid quantified groups.</div>
<div class="header_para">
<div class="normal-para"><big><strong>Complete Example</strong></big></div>
</div>
<div class="normal-para"><strong>Highlighting XML/SGML content</strong> <br    />Following a simple highlight configuration for highlighting XML/SGML content:</div>
<div class="normal-para code_listing">### Regular expression constants ###<br    /> %NAME% : [A-Za-z0-9_:\-\.]+<br    /> %ATT_VALUE% : %NAME%|("[^"]*")|('[^']*')<br    />  <br    /> ###<br    /> ### Highlight configuration ###<br    /> ###<br    />  <br    /> ::XML_START<br    />  <br    /> # Comments<br    /> comment_style : &lt;!--.*?--&gt;<br    />  <br    /> # Start of element tag<br    /> tag_style : &lt;%NAME%\s*<br    />  -&gt; XML_ATTRIBUTES<br    />  <br    /> # Closing element tag<br    /> tag_style : &lt;/%NAME%&gt; <br    /> <br    /> ::XML_ATTRIBUTES<br    />  <br    /> # Element attribute<br    /> attrib_style,, attrib_value_style : %NAME%(\s*=\s*(%ATT_VALUE%))?\s*<br    />  <br    /> # End of element tag<br    /> tag_style : /?&gt;<br    />  -&gt; XML_START</div>
<div class="normal-para">The highlight configuration starts with the definition of the regular-expression constant <tt>%NAME%</tt>, which holds the pattern of an element/attribute name. Here, an element/attribute name is defined as a sequence of letters, digits, the underscore, the colon, the dash and the dot character. Note that the XML specification allows more characters to be used within element and attribute names, however this configuration should be sufficient in most cases.</div>
<div class="normal-para">The second definition is the constant <tt>%ATT_VALUE%</tt> which holds the pattern of an attribute value. Here, an attribute value is defined as either a string that follows the rules of an element/attribute name or as a string enclosed in double or single quotes. As you can see, the regular-expression constant <tt>%ATT_VALUE%</tt> references the previously defined constant <tt>%NAME%</tt>. This way it is possible to avoid repetition of expressions. Be aware that a constant has to be defined <em>before</em> it is referenced.</div>
<div class="normal-para">The constant definitions are followed by two state definitions: <tt>XML_START</tt> and <tt>XML_ATTRIBUTES</tt>. The initial state <tt>XML_START</tt> defines three rules. The first assigns the style <tt>comment_style</tt> to a regular-expression that matches XML/SGML comments (note that the reluctant quantifier <tt>*?</tt> is used here). The second assignes the style <tt>tag_style</tt> to a regular-expression that matches the start of an XML element. If the start of an element is matched, then the state changes from <tt>XML_START</tt> to <tt>XML_ATTRIBUTES</tt>. The third assigns the style <tt>tag_style</tt> to a regular-expression that matches closing tags.</div>
<div class="normal-para">The second state <tt>XML_ATTRIBUTES</tt> defines two rules. The first rule matches an attribute. An attribute is a name which is optionally followed by a <tt>=</tt> character and an attribute value. An attribute is formatted with style <tt>attrib_style</tt>. The attribute value is formatted with style <tt>attrib_value_style</tt>. Note that the expression <tt>\s*</tt> allows an arbitrary number of whitespace characters between the name- and value-part of attributes. As long as attributes are matched, the state remains in state <tt>XML_ATTRIBUTES</tt>.</div>
<div class="normal-para">The second rule within <tt>XML_ATTRIBUTES</tt> matches the end of the element tag. In case of an opening tag, this is a single <tt>&gt;</tt> character. In case of an element without content, this is a slash followed by a <tt>&gt;</tt> (i.e. <tt>/&gt;</tt>). If the end of an element tag is matched then state changes back from <tt>XML_ATTRIBUTES</tt> to <tt>XML_START</tt>.</div>
<div class="normal-para">The highlight configuration above may also work for content that does not completely follow the XML/SGML rules. It is also assumed that the characters &lt; and &gt; are encoded as character entities <tt>&amp;lt;</tt> and <tt>&amp;gt;</tt> if not part of a XML/SGML tag. Otherwise the automatic highlighting may produce unexpected results.</div>
<div class="normal-para"><strong>Applying the highlight transformation</strong> <br    />Given a file with alias name <tt>highlight_xml</tt> which contains the highlight configuration shown above, and a style with ID <tt>listing_xml</tt> which has following Auto-Format call assigned:</div>
<div class="normal-para code_listing">org.docma.plugin.examples.RegExpHighlight cfg=highlight_xml</div>
<div class="normal-para">Then following content</div>
<div class="normal-para code_listing">&lt;div class="listing_xml"&gt;<br    />  &amp;lt;!-- An example --&amp;gt;<br    />  &amp;lt;elem <br    />    att="A value"&amp;gt;<br    />    The content of the element<br    />  &amp;lt;/elem&amp;gt;<br    /> &lt;/div&gt;</div>
<div class="normal-para">is rendered as</div>
<div class="normal-para code_listing">&lt;div class="listing_xml"&gt;<br    />  &lt;span class="comment_style"&gt;&amp;lt;!-- An example --&amp;gt;&lt;/span&gt;<br    />  &lt;span class="tag_style"&gt;&amp;lt;elem <br    />    &lt;span class="attrib_style"&gt;att=&lt;span<br    />          class="attrib_value_style"&gt;"A value"&lt;/span&gt;&lt;/span&gt;<br    />    &amp;gt;&lt;/span&gt;<br    />    The content of the element<br    />  &lt;span class="tag_style"&gt;&amp;lt;/elem&amp;gt;&lt;/span&gt;<br    /> &lt;/div&gt;</div>
<div class="normal-para">Note that within the content to be highlighted, the characters &lt; and &gt; are encoded as character entities <tt>&amp;lt;</tt> and <tt>&amp;gt;</tt>. However, the regular-expressions match the XML tags correctly, because the <tt>decode</tt> argument has the default value <tt>true</tt>, i.e. character entities are decoded before the pattern matching is applied.</div>
</div></div><div class="navfooter"><hr/><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="ref_af_formatlines.html"><span class="navlink-text">Prev</span></a>&#160;</td><td width="20%" align="center"><a accesskey="u" href="ref_autoformat_classes.html"><span class="navlink-text">Up</span></a></td><td width="40%" align="right">&#160;<a accesskey="n" href="ref_af_xsltautoformat.html"><span class="navlink-text">Next</span></a></td></tr><tr><td width="40%" align="left" valign="top">2.8.2. org.docma.plugin.examples.FormatLines&#160;</td><td width="20%" align="center"><a accesskey="h" href="index.html"><span class="navlink-text">Home</span></a></td><td width="40%" align="right" valign="top">&#160;2.8.4. org.docma.plugin.examples.XSLTAutoFormat</td></tr></table></div>
<div class="web_footer">
<p class="align-center">&#169; 2017 - www.docmenta.org</p>
</div>
</div>
<a id="showHideButton" onclick="showHideToc();" class="pointLeft" title="Hide TOC tree">&nbsp;</a></body>
</html>
